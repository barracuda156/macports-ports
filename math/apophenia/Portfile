# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

github.setup        b-k apophenia 113671c16afa1724f9f225acdc88e838770071ce
version             20191219
revision            0
categories          math science
license             GPL-2

maintainers         gmail.com:el.dirte \
                    openmaintainer

description         A C library for statistical and scientific computing
long_description    Apophenia is an open statistical library for working with \
                    data sets and statistical models. It provides functions on \
                    the same level as those of the typical stats package (such \
                    as OLS, Probit, or singular value decomposition) but gives \
                    the user more flexibility to be creative in model-building. \
                    The core functions are written in C.

homepage            http://apophenia.info

checksums           rmd160  7d2bfb06ab0d99ab5178ce36558bac82c3fe20cb \
                    sha256  392f3cf5d7da397d093a484f91a8da8e578692f9856642323ad14a4e463b2eba \
                    size    513323

depends_build-append \
                    port:autoconf \
                    port:automake \
                    port:libtool \
                    port:pkgconfig

depends_lib-append  port:gsl \
                    port:sqlite3

# https://github.com/b-k/apophenia/issues/44
compiler.thread_local_storage yes

# These are ignored by the build system: https://github.com/b-k/apophenia/issues/45
configure.args-append   --enable-extended-tests \
                        --with-mysql=no

patchfiles-append   patch-no-mysql.diff \
                    patch-no-test-dirichlet.diff

post-patch {
    reinplace "s,@ARCHFLAGS@,[get_canonical_archflags cc]," ${worksrcpath}/install/Makefile.am
    reinplace "s,@PREFIX@,${prefix}," ${worksrcpath}/install/apophenia.pc.in
    reinplace "s,@CFLAGS@,," ${worksrcpath}/install/apophenia.pc.in
}

build {
    system -W ${worksrcpath}/apophenia-1.0 "make -j${build.jobs}"
}

destroot {
    # Need to fix
}

test.run            yes
test.target         check

# /opt/local/bin/apop_db_to_crosstab
# /opt/local/bin/apop_plot_query
# /opt/local/bin/apop_text_to_db
# /opt/local/include/apop.h
# /opt/local/lib/libapophenia.2.dylib
# /opt/local/lib/libapophenia.a
# /opt/local/lib/libapophenia.dylib
# /opt/local/lib/pkgconfig/apophenia.pc