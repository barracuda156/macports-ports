# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cmake 1.1
PortGroup           compiler_blacklist_versions 1.0
PortGroup           github 1.0
PortGroup           legacysupport 1.1

github.setup        mheily libpwq aad3aa3faeebcd27eb8c29db7b1cf7affd22cfa6
version             2022.08.01
revision            0
categories          devel
description         ibpthread_workqueue – a POSIX threads workqueue library
long_description    ibpthread_workqueue – a POSIX threads workqueue library. \
                    libpwq was designed to be used with an older version \
                    of libdispatch and is not compatible with newer versions.
license             BSD
maintainers         {@barracuda156 gmail.com:vital.had} openmaintainer

checksums           rmd160  dd44c5a73176237d7aeb3b45da660f7fa06bd3f1 \
                    sha256  0c3accc0b2a460da18a6a5944d7105c9882bb859e13b4cbcfc04f7f2bff0c0b3 \
                    size    57824

# clock_gettime
legacysupport.newest_darwin_requires_legacy 15

patchfiles          patch-cmakelists.diff \
                    patch-manager.diff \
                    patch-platform.diff \
                    patch-private.h.diff \
                    patch-pthread_workqueue.h.diff \
                    patch-threadid.diff

compiler.blacklist  *gcc-3.* *gcc-4.* {clang < 421}
# ld: duplicate symbol _libpwq_thread_cleanup_handler in CMakeFiles/pthread_workqueue.dir/src/witem_cache.c.o
# and CMakeFiles/pthread_workqueue.dir/src/api.c.o

configure.cppflags-append \
                    -D_DARWIN_C_SOURCE

variant tests description {Run tests} {
    configure.pre_args-replace \
                    -DCMAKE_BUILD_WITH_INSTALL_RPATH:BOOL=ON \
                    -DCMAKE_BUILD_WITH_INSTALL_RPATH:BOOL=OFF
    configure.args-append \
                    -DENABLE_TESTING=YES
    test.run        yes
    test.target     test
}
