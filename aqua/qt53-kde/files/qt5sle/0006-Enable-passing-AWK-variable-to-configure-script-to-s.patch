From 628f02a4fe34d942a11dbe91a24b1deccf376d97 Mon Sep 17 00:00:00 2001
From: Daniel Kettle <initial.dann@gmail.com>
Date: Mon, 14 Aug 2023 11:41:54 -0600
Subject: [PATCH 6/7] Enable passing AWK variable to configure script to select
 awk

  - Mainly for testing purposes.
  - Changed \# => #  in awk string to avoid error. Fixed for gawk/nawk/mawk
---
 qtbase/configure | 21 +++++++++++----------
 1 file changed, 11 insertions(+), 10 deletions(-)

diff --git qtbase/configure qtbase/configure
index 84f0e2876..2c2be566a 100755
--- qtbase/configure
+++ qtbase/configure
@@ -60,15 +60,16 @@ WHICH="$unixtests/which.test"
 
 PERL=`$WHICH perl 2>/dev/null`
 
-# find out which awk we want to use, prefer gawk, then nawk, then regular awk
-AWK=
-for e in mawk nawk gawk awk; do
-    if "$WHICH" $e >/dev/null 2>&1 && ( $e -f /dev/null /dev/null ) >/dev/null 2>&1; then
-        AWK=$e
-        break
-    fi
-done
-
+# find out which awk we want to use if not explicitly set.
+# Prefer mawk, nawk then gawk and regular awk
+if [ -z "$AWK" ]; then
+    for e in mawk nawk gawk awk; do
+        if "$WHICH" $e >/dev/null 2>&1 && ( $e -f /dev/null /dev/null ) >/dev/null 2>&1; then
+            AWK=$e
+            break
+        fi
+    done
+fi
 # find a make command
 if [ -z "$MAKE" ]; then
     MAKE=
@@ -3293,7 +3294,7 @@ function normalize(dir)
 #   #include <...> search starts here:
 # and
 #   End of search list.
-/^\#include </ { yup=1; print "DEFAULT_INCDIRS=\""; next }
+/^#include </ { yup=1; print "DEFAULT_INCDIRS=\""; next }
 /^End of search/ { yup=0; print "\"\n" }
 / \(framework directory\)$/ { next }
 yup { print normalize(substr($0, 2)) "\n"; ++incs }
