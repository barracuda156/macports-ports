# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

github.setup        ygrek ocaml-extlib 1.7.9
revision            0
categories          ocaml devel
maintainers         {pmetzger @pmetzger} openmaintainer
license             LGPL-2.1
description         Extended Standard Library for OCaml
long_description    A User-supported Extended Standard Library for OCaml

checksums           rmd160  67be2c9a21da459d321d66bea8f885f2fb16508a \
                    sha256  1d4c8910c7c9a0132918d8699cf94783749267a69d48d455625cc89037219cbb \
                    size    91104

depends_build       port:ocaml-cppo
depends_lib         port:ocaml port:ocaml-findlib

patch.pre_args      -p1
patchfiles          0001-ocaml-extlib-fix-Makefile-to-include-bytecode-only-t.patch

use_configure       no

post-patch           {
    reinplace s|^VERSION:=\$(shell.*|| ${worksrcpath}/Makefile
}

use_parallel_build  no

if {${build_arch} in [list ppc ppc64]} {
    build.target    minimal=1 all
} else {
    build.target    minimal=1 build
}

destroot.target     minimal=1 install

pre-destroot {
        set extlib_destdir ${destroot}[exec ${prefix}/bin/ocamlfind printconf destdir]
        xinstall -m 755 -d ${extlib_destdir}
        reinplace "s|ocamlfind install|ocamlfind install -destdir ${extlib_destdir} |" ${worksrcpath}/src/Makefile
}

test.run            yes
